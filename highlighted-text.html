<link rel="import" href="../polymer/polymer.html">

<!--
A polymer web component that shows tagged text with highlights.

Example:

        <highlighted-text
          text="The <tag>quick brown</tag> fox jumped over the <tag>lazy</tag> dog."
          tags="tag">
        </highlighted-text>

Styling:

Custom property            | Description                        | Default
---------------------------|------------------------------------|--------
`--highlighted-text-color` | The color of the highlighted text. | yellow

@demo demo/index.html
-->

<dom-module id="highlighted-text">
  <template>
    <style>
      :host {
        display: block;
      }

      .highlight {
        background-color: var(--highlighted-text-color, yellow);
      }
    </style>

    <template is="dom-repeat" items="[[_spans]]">
      <span id$="[[_getId(index)]]" class$="[[item.styleClass]]">[[item.text]]</span>
    </template>
  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'highlighted-text',

      properties: {
        /**
         * The tags (without punctuation) surrounding the words to highlight in the text.  For example, if the text is '<tag>Text</tag>' then set the tags to 'tag'.
         * @type {String}
         * @default 'highlight'
         */
        tags: {
          type: String,
          value: 'highlight'
        },

        /**
         * The text containing words to highlight.
         * @type {String}
         */
        text: {
          type: String
        },

        /**
         * The spans to show generated by this component from the given tags and text.
         * @type {Array}
         * @private
         */
        _spans: {
          type: Array,
          computed: '_updateSpans(tags, text)'
        }
      },

      /**
       * Finds and returns spans of the given text by searching for the given start and end tags.
       * @param {String} startTag
       * @param {String} endTag
       * @param {String} text
       * @return {Array} The array of span objects with the string properties "text" and "styleClass"
       * @private
       */
      _findSpans: function(startTag, endTag, text) {
        var spans = [];

        var startIndex = text.indexOf(startTag);
        var endIndex = text.indexOf(endTag);

        if(startIndex >= 0 && endIndex >= 0) {
          if(startIndex > 0) {
            spans.push({
              text: text.substring(0, startIndex),
              styleClass: ''
            });
          }
          spans.push({
            text: text.substring(startIndex + startTag.length, endIndex),
            styleClass: 'highlight'
          });
          return spans.concat(this._findSpans(startTag, endTag, text.substring(endIndex + endTag.length)));
        }

        return [{
          text: text,
          styleClass: ''
        }];
      },

      /**
       * Returns the ID for the span at the given index.
       * @param {Number} index
       * @return {String} The ID
       * @private
       */
      _getId: function(index) {
        return 'span' + index;
      },

      /**
       * Returns the updated spans using the given tags and text.
       * @param {String} tags
       * @param {String} text
       * @return {Array} The array of span objects with the string properties "text" and "styleClass"
       * @private
       */
      _updateSpans: function(tags, text) {
        var startTag = '<' + tags + '>';
        var endTag = '</' + tags + '>';
        return this._findSpans(startTag, endTag, text);
      }
    });
  })();
  </script>
</dom-module>
